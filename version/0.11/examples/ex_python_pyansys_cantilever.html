
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="og:site_name" content="PyAnsys" />
    <title>PyAnsys workflow: Cantilever &#8212; PyHPS</title>
  
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/ansys-sphinx-theme.css?v=ce7f2556" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/autodoc_pydantic.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/ansys-sphinx-theme.css?v=ce7f2556" />
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/jquery.dataTables.min.css" />
    <link rel="stylesheet" type="text/css" href="https://www.nerdfonts.com/assets/css/webfont.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />


  <!-- Include desired assets -->
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
  

  
    <link href="../_static/css/breadcrumbs.css" rel="stylesheet" />
  
    <script src="../_static/documentation_options.js?v=b3db6a4d"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'examples/ex_python_pyansys_cantilever';</script>
    <script>
        DOCUMENTATION_OPTIONS.theme_version = '0.16.1';
        DOCUMENTATION_OPTIONS.theme_switcher_json_url = 'https://hps.docs.pyansys.com/versions.json';
        DOCUMENTATION_OPTIONS.theme_switcher_version_match = '0.11';
        DOCUMENTATION_OPTIONS.show_version_warning_banner =
            false;
        </script>
    <link rel="icon" href="../_static/ansys-favicon.png"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Contribute" href="../contribute.html" />
    <link rel="prev" title="Run arbitrary Python scripts on HPS" href="ex_python_uv.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="0.11.1" />
  <link rel="canonical" href="https://hps.docs.pyansys.com/version/stable/examples/ex_python_pyansys_cantilever.html" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/pyansys_logo_transparent_black.png" class="logo__image only-light" alt="PyHPS - Home"/>
    <img src="../_static/pyansys_logo_transparent_white.png" class="logo__image only-dark pst-js-only" alt="PyHPS - Home"/>
  
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contribute.html">
    Contribute
  </a>
</li>

  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
      
        <div class="navbar-item">
<div class="search-bar pst-js-only" id="search-bar">
  <form class="bd-search d-flex align-items-center" action="../search.html" method="get">
    <i class="fa-solid fa-magnifying-glass"></i>
    <input type="search" class="form-control" name="q" placeholder="Search the docs ..."
      aria-label="Search the docs ..." autocomplete="off" autocorrect="off"
      autocapitalize="off" spellcheck="false" />
    <span class="search-button__kbd-shortcut">
      <kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd>
    </span>
  </form>
  <div id="static-search-results" class="static-search-results" style="display:none;" tabindex="0"></div>
</div></div>
      
        <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-2"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-2"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-2"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-2">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/pyhps" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  
  
    <div id="announcement_msg"></div>
<script>
  fetch("announcement.html")
    .then((response) => {
      if (!response.ok) {
        throw new Error(`HTTP error: ${response.status}`);
      }
      return response.text();
    })
    .then(
      (text) => (document.getElementById("announcement_msg").innerHTML = text),
    )
    .catch((error) => console.error(`Fetch problem: ${error.message}`));
</script>
  


  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started/index.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide/index.html">
    User guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../api/index.html">
    API reference
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="index.html">
    Examples
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../contribute.html">
    Contribute
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<div class="search-bar pst-js-only" id="search-bar">
  <form class="bd-search d-flex align-items-center" action="../search.html" method="get">
    <i class="fa-solid fa-magnifying-glass"></i>
    <input type="search" class="form-control" name="q" placeholder="Search the docs ..."
      aria-label="Search the docs ..." autocomplete="off" autocorrect="off"
      autocapitalize="off" spellcheck="false" />
    <span class="search-button__kbd-shortcut">
      <kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd>
    </span>
  </form>
  <div id="static-search-results" class="static-search-results" style="display:none;" tabindex="0"></div>
</div></div>
        
          <div class="navbar-item">
<div class="version-switcher__container dropdown pst-js-only">
  <button id="pst-version-switcher-button-3"
    type="button"
    class="version-switcher__button btn btn-sm dropdown-toggle"
    data-bs-toggle="dropdown"
    aria-haspopup="listbox"
    aria-controls="pst-version-switcher-list-3"
    aria-label="Version switcher list"
  >
    Choose version  <!-- this text may get changed later by javascript -->
    <span class="caret"></span>
  </button>
  <div id="pst-version-switcher-list-3"
    class="version-switcher__menu dropdown-menu list-group-flush py-0"
    role="listbox" aria-labelledby="pst-version-switcher-button-3">
    <!-- dropdown will be populated by javascript on page load -->
  </div>
</div></div>
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ansys/pyhps" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<nav class="bd-docs-nav bd-links"
     aria-label="Section Navigation">
  <p class="bd-links__title" role="heading" aria-level="1">Section Navigation</p>
  <div class="bd-toc-item navbar-nav"><ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ex_motorbike_frame.html">MAPDL motorbike frame: Project creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="ex_motorbike_frame_query.html">MAPDL motorbike frame: Project query</a></li>
<li class="toctree-l1"><a class="reference internal" href="ex_mapdl_tire_performance.html">MAPDL tire performance</a></li>
<li class="toctree-l1"><a class="reference internal" href="ex_mapdl_linked_analyses.html">MAPDL linked analyses</a></li>
<li class="toctree-l1"><a class="reference internal" href="ex_lsdyna_job.html">LS-DYNA job submission</a></li>
<li class="toctree-l1"><a class="reference internal" href="ex_fluent_2d_heat_exchanger.html">Fluent 2D heat exchanger</a></li>
<li class="toctree-l1"><a class="reference internal" href="ex_fluent_nozzle.html">Fluent nozzle</a></li>
<li class="toctree-l1"><a class="reference internal" href="ex_cfx_static_mixer.html">CFX static mixer</a></li>
<li class="toctree-l1"><a class="reference internal" href="ex_python_two_bar.html">Two-bar truss</a></li>
<li class="toctree-l1"><a class="reference internal" href="ex_python_uv.html">Run arbitrary Python scripts on HPS</a></li>


<li class="toctree-l1 current active"><a class="current reference internal" href="#">PyAnsys workflow: Cantilever</a></li>




</ul>
</div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">
<nav aria-label="Breadcrumb">
  <ul class="bd-breadcrumbs">
         
    <li class="breadcrumb-item breadcrumb-home">
      <a href="https://docs.pyansys.com/" class="nav-link">PyAnsys</a>
    </li>
     
    <li class="breadcrumb-item">
      <a
        href="../index.html"
        class="nav-link"
        aria-label="Home"
      >
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
     
    <li class="breadcrumb-item">
      <a href="index.html" class="nav-link">Examples</a>
    </li>
      
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis">PyAnsys workflow: Cantilever</span></li>
    
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="admonition note" id="example-python-pyansys-cantilever">
<p class="admonition-title">Note</p>
<p>Go to the <a class="reference internal" href="#bottom-of-this-page">bottom of this page</a> to download the ZIP file for the PyAnsys cantilever example.</p>
</div>
<section id="pyansys-workflow-cantilever">
<h1>PyAnsys workflow: Cantilever<a class="headerlink" href="#pyansys-workflow-cantilever" title="Link to this heading">#</a></h1>
<p>This example shows how to run PyAnsys scripts on HPS.
It simulates a cantilever using a chain of PyAnsys packages:</p>
<ol class="arabic simple">
<li><p>Use <a class="reference external" href="https://geometry.docs.pyansys.com/">PyAnsys Geometry</a> to draw
a cantilever design.</p></li>
<li><p>Use <a class="reference external" href="https://prime.docs.pyansys.com/">PyPrimeMesh</a> to apply a
swept mesh to the cantilever design.</p></li>
<li><p>Use <a class="reference external" href="https://mapdl.docs.pyansys.com/">PyMAPDL</a> to calculate
eigenfrequencies of the cantilever and then display them as output
parameters.</p></li>
</ol>
<p>The example parametrizes the physical cantilever dimensions, as well as several mesh and simulation
properties.</p>
</section>
<section id="prerequisites">
<h1>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">#</a></h1>
<p>Several packages need to be installed for the example.
The paths and versions in the following setup instructions are
for an Ansys 2025 R2 installation on a Linux
system. Be sure to adjust them to your installation.</p>
<section id="uv">
<h2>uv<a class="headerlink" href="#uv" title="Link to this heading">#</a></h2>
<p>The example uses the <a class="reference external" href="https://docs.astral.sh/uv/">uv</a> package manager to run
Python scripts. You can find more information, including installation instructions, in the
<a class="reference external" href="https://hps.docs.pyansys.com/version/0.11/examples/ex_python_uv.html#example-python-uv" title="(in Ansys pyhps v0.11.1)"><span class="xref std std-ref">example_python_uv</span></a> example.</p>
</section>
<section id="ansys-geometry-service">
<h2>Ansys Geometry Service<a class="headerlink" href="#ansys-geometry-service" title="Link to this heading">#</a></h2>
<p>The PyAnsys Geometry package requires the Ansys Geometry Service. For installation instructions, see
<a class="reference external" href="https://geometry.docs.pyansys.com/version/stable/getting_started/faq.html#how-is-the-ansys-geometry-service-installed">How is the Ansys Geometry Service installed?</a>
in the <em>Frequently asked questions</em> section of PyAnsys Geometry documentation.
Once installed, the package must be registered in the scaler/evaluator as follows:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Name</p></td>
<td><p>Ansys Geometry Service</p></td>
</tr>
<tr class="row-odd"><td><p>Version</p></td>
<td><p>2025 R2</p></td>
</tr>
<tr class="row-even"><td><p>Installation Path</p></td>
<td><p>/ansys_inc/v252/GeometryService</p></td>
</tr>
</tbody>
</table>
</div>
<p>You must also ensure that these environment variables are defined:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Environment variable</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ANSRV_GEO_LICENSE_SERVER</p></td>
<td><p>&lt;<a class="reference external" href="mailto:LICENSE&#37;&#52;&#48;SERVER">LICENSE<span>&#64;</span>SERVER</a>&gt;</p></td>
</tr>
<tr class="row-odd"><td><p>ANSYS_GEOMETRY_SERVICE_ROOT</p></td>
<td><p>/ansys_inc/v252/GeometryService</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="ansys-prime-server">
<h2>Ansys Prime Server<a class="headerlink" href="#ansys-prime-server" title="Link to this heading">#</a></h2>
<p>The PyPrimeMesh package requires Ansys Prime Server, which is automatically installed with Ansys
2023 R1 or later. Ansys Prime Server must be registered in the scaler/evaluator as follows:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Property</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Name</p></td>
<td><p>Ansys Prime Server</p></td>
</tr>
<tr class="row-odd"><td><p>Version</p></td>
<td><p>2025 R2</p></td>
</tr>
<tr class="row-even"><td><p>Installation Path</p></td>
<td><p>/ansys_inc/v252/meshing/Prime</p></td>
</tr>
</tbody>
</table>
</div>
<p>You must also ensure that these environment variables are defined:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Environment variable</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AWP_ROOT252</p></td>
<td><p>/ansys_inc/v252</p></td>
</tr>
<tr class="row-odd"><td><p>ANSYS_PRIME_ROOT</p></td>
<td><p>/ansys_inc/v252/meshing/Prime</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="ansys-mechanical-apdl">
<h2>Ansys Mechanical APDL<a class="headerlink" href="#ansys-mechanical-apdl" title="Link to this heading">#</a></h2>
<p>Ansys Mechanical APDL is installed with the Ansys unified installer.
The scaler/evaluator automatically detects this package, but you must ensure that these
two environment variables are added to its registration for PyMAPDL:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Environment variable</strong></p></th>
<th class="head"><p><strong>Value</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>AWP_ROOT252</p></td>
<td><p>/ansys_inc/v252</p></td>
</tr>
<tr class="row-odd"><td><p>PYMAPDL_MAPDL_EXEC</p></td>
<td><p>/ansys_inc/v252/ansys/bin/ansys252</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="hps-python-client">
<h2>HPS Python Client<a class="headerlink" href="#hps-python-client" title="Link to this heading">#</a></h2>
<p>The example uses unmapped HPS parameters and therefore requires PyHPS 0.11 or later.</p>
</section>
</section>
<section id="run-the-example">
<h1>Run the example<a class="headerlink" href="#run-the-example" title="Link to this heading">#</a></h1>
<p>To run the example, execute the <code class="docutils literal notranslate"><span class="pre">project_setup.py</span></code> script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">uv</span> <span class="n">run</span> <span class="n">project_setup</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This command sets up a project with a number of jobs.
Each job samples a different cantilever design point.</p>
<section id="options">
<h2>Options<a class="headerlink" href="#options" title="Link to this heading">#</a></h2>
<p>The example supports the following command line arguments:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Flag</strong></p></th>
<th class="head"><p><strong>Example</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-U</span></code>, <code class="docutils literal notranslate"><span class="pre">--url</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--url=https://localhost:8443/hps</span></code></p></td>
<td><p>URL of the target HPS instance</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-u</span></code>, <code class="docutils literal notranslate"><span class="pre">--username</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--username=repuser</span></code></p></td>
<td><p>Username to log into HPS</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-p</span></code>, <code class="docutils literal notranslate"><span class="pre">--password</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--password=topSecret</span></code></p></td>
<td><p>Password to log into HPS</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-n</span></code>, <code class="docutils literal notranslate"><span class="pre">--num-jobs</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--num-jobs=50</span></code></p></td>
<td><p>Number of design points to generate</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-m</span></code>, <code class="docutils literal notranslate"><span class="pre">--num-modes</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--num-modes=3</span></code></p></td>
<td><p>Number of lowest eigenfrequencies to calculate</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">-f</span></code>, <code class="docutils literal notranslate"><span class="pre">--target-frequency</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--target-frequency=100.0</span></code></p></td>
<td><p>Frequency in Hertz to target for the lowest cantilever mode</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">-s</span></code>, <code class="docutils literal notranslate"><span class="pre">--split-tasks</span></code></p></td>
<td><p><code class="docutils literal notranslate"><span class="pre">--split-tasks</span></code></p></td>
<td><p>Split each step into a different task</p></td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">#</a></h2>
<p>The example defines the following HPS parameters:</p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p><strong>Parameter</strong></p></th>
<th class="head"><p><strong>Description</strong></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>canti_length</p></td>
<td><p>Length of the cantilever [um]</p></td>
</tr>
<tr class="row-odd"><td><p>canti_width</p></td>
<td><p>Width of the cantilever [um]</p></td>
</tr>
<tr class="row-even"><td><p>canti_thickness</p></td>
<td><p>Thickness of the cantilever [um]</p></td>
</tr>
<tr class="row-odd"><td><p>arm_cutoff_width</p></td>
<td><p>Amount to thin the cantilever arm by [um]</p></td>
</tr>
<tr class="row-even"><td><p>arm_cutoff_length</p></td>
<td><p>Length of the cantilever arm [um]</p></td>
</tr>
<tr class="row-odd"><td><p>arm_slot_width</p></td>
<td><p>Width of the slot cut into the cantilever arm [um]</p></td>
</tr>
<tr class="row-even"><td><p>arm_slot</p></td>
<td><p>Whether there is a slot in the cantilever arm</p></td>
</tr>
<tr class="row-odd"><td><p>young_modulus</p></td>
<td><p>Young Modulus of the cantilever material [Pa]</p></td>
</tr>
<tr class="row-even"><td><p>density</p></td>
<td><p>Density of the cantilever material [kg/m^3]</p></td>
</tr>
<tr class="row-odd"><td><p>poisson_ratio</p></td>
<td><p>Poisson ratio of the cantilever material</p></td>
</tr>
<tr class="row-even"><td><p>mesh_swept_layers</p></td>
<td><p>Number of layers to generate when sweeping the mesh</p></td>
</tr>
<tr class="row-odd"><td><p>num_modes</p></td>
<td><p>Number of eigenfrequencies to calculate</p></td>
</tr>
<tr class="row-even"><td><p>popup_plots</p></td>
<td><p>Whether to show popup plots (requires a framebuffer)</p></td>
</tr>
<tr class="row-odd"><td><p>port_geometry</p></td>
<td><p>Port used by Ansys GeometryService</p></td>
</tr>
<tr class="row-even"><td><p>port_mesh</p></td>
<td><p>Port used by Ansys Prime Server</p></td>
</tr>
<tr class="row-odd"><td><p>port_mapdl</p></td>
<td><p>Port used by the Ansys Mechanical APDL service</p></td>
</tr>
<tr class="row-even"><td><p>freq_mode_i</p></td>
<td><p>Frequency of i-th eigenmode [Hz], iϵ{1,…,num_modes}</p></td>
</tr>
<tr class="row-odd"><td><p>clean_venv</p></td>
<td><p>Whether to delete the virtual environments after execution</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
<section id="logic-of-the-example">
<h1>Logic of the example<a class="headerlink" href="#logic-of-the-example" title="Link to this heading">#</a></h1>
<p>The example comprises several files. Their roles are as follows:</p>
<p>The <code class="docutils literal notranslate"><span class="pre">project_setup.py</span></code> script handles all communication with the HPS instance.
It sets up a project, uploads files, defines parameters, and applies settings.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">exec_script</span></code> script is the execution script that starts
the evaluation scripts. It first writes all
HPS parameters to an <code class="docutils literal notranslate"><span class="pre">input_parameters.json</span></code> file, discovers
the available software, and then runs the active evaluation script with uv.
Finally, the execution script fetches parameters that may have been written to
the <code class="docutils literal notranslate"><span class="pre">output_parameters.json</span></code> file by the evaluation script and sends them
back to the evaluator. Optionally, the execution script cleans up the ephemeral virtual environments
created by uv.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">eval_scripts</span></code> folder contains the PyAnsys evaluation scripts.
Each of the evaluation scripts first reads the parameters supplied by the execution script
in the <code class="docutils literal notranslate"><span class="pre">input_parameters.json</span></code> file, then starts a PyAnsys service, and
finally runs the PyAnsys program.
The <code class="docutils literal notranslate"><span class="pre">eval_combined.py</span></code> script  combines all stages in one monolithic task.
The other three evaluation scripts split the three stages into three successive tasks.
You can find more information on the content of these scripts in the
<a class="reference external" href="https://geometry.docs.pyansys.com/version/stable/user_guide/index.html">User guide</a>
of PyAnsys Geometry, in the
<a class="reference external" href="https://prime.docs.pyansys.com/version/stable/user_guide/index.html">User guide</a>
of PyPrimeMesh, and in the
<a class="reference external" href="https://mapdl.docs.pyansys.com/version/stable/user_guide/index.html">User guide</a>
of PyMAPDL.</p>
</section>
<section id="code">
<h1>Code<a class="headerlink" href="#code" title="Link to this heading">#</a></h1>
<p>The files relevant for the single task version follow.</p>
<p>Here is the <code class="docutils literal notranslate"><span class="pre">project_setup.py</span></code> script for project creation:</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">project_setup.py</span><a class="headerlink" href="#id1" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># /// script</span>
<span class="c1"># requires-python = &quot;==3.10&quot;</span>
<span class="c1"># dependencies = [</span>
<span class="c1">#     &quot;ansys-hps-client @ git+https://github.com/ansys/pyhps.git@main&quot;,</span>
<span class="c1">#     &quot;packaging&quot;,</span>
<span class="c1">#     &quot;typer&quot;,</span>
<span class="c1"># ]</span>
<span class="c1"># ///</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">random</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">typer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">packaging</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">ansys.hps.client</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ansys.hps.client</span><span class="w"> </span><span class="kn">import</span> <span class="n">Client</span><span class="p">,</span> <span class="n">HPSError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ansys.hps.client.jms</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
    <span class="n">BoolParameterDefinition</span><span class="p">,</span>
    <span class="n">File</span><span class="p">,</span>
    <span class="n">FitnessDefinition</span><span class="p">,</span>
    <span class="n">FloatParameterDefinition</span><span class="p">,</span>
    <span class="n">IntParameterDefinition</span><span class="p">,</span>
    <span class="n">JmsApi</span><span class="p">,</span>
    <span class="n">Job</span><span class="p">,</span>
    <span class="n">JobDefinition</span><span class="p">,</span>
    <span class="n">Project</span><span class="p">,</span>
    <span class="n">ProjectApi</span><span class="p">,</span>
    <span class="n">ResourceRequirements</span><span class="p">,</span>
    <span class="n">Software</span><span class="p">,</span>
    <span class="n">SuccessCriteria</span><span class="p">,</span>
    <span class="n">TaskDefinition</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">num_jobs</span><span class="p">,</span> <span class="n">num_modes</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">split_tasks</span><span class="p">):</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== Create Project&quot;</span><span class="p">)</span>
    <span class="n">jms_api</span> <span class="o">=</span> <span class="n">JmsApi</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>
    <span class="n">tasks_config</span> <span class="o">=</span> <span class="s2">&quot;Split&quot;</span> <span class="k">if</span> <span class="n">split_tasks</span> <span class="k">else</span> <span class="s2">&quot;Combined&quot;</span>

    <span class="n">proj</span> <span class="o">=</span> <span class="n">jms_api</span><span class="o">.</span><span class="n">create_project</span><span class="p">(</span>
        <span class="n">Project</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Cantilever - </span><span class="si">{</span><span class="n">num_jobs</span><span class="si">}</span><span class="s2"> Designs - </span><span class="si">{</span><span class="n">tasks_config</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">priority</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">project_api</span> <span class="o">=</span> <span class="n">ProjectApi</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">proj</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== Define Files&quot;</span><span class="p">)</span>
    <span class="c1"># Input files</span>
    <span class="n">cwd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
    <span class="n">step_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span> <span class="s2">&quot;mesh&quot;</span><span class="p">,</span> <span class="s2">&quot;mapdl&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">split_tasks</span><span class="p">:</span>
        <span class="n">step_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;combined&quot;</span><span class="p">]</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">step_name</span> <span class="ow">in</span> <span class="n">step_names</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;eval_</span><span class="si">{</span><span class="n">step_name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">File</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">evaluation_path</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.py&quot;</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
                <span class="n">src</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s2">&quot;eval_scripts&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">.py&quot;</span><span class="p">),</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">File</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;exec_script&quot;</span><span class="p">,</span>
            <span class="n">evaluation_path</span><span class="o">=</span><span class="s2">&quot;exec_script.py&quot;</span><span class="p">,</span>
            <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
            <span class="n">src</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">cwd</span><span class="p">,</span> <span class="s2">&quot;exec_script.py&quot;</span><span class="p">),</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="c1"># Output files</span>
    <span class="n">files</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">File</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cantilever_geometry&quot;</span><span class="p">,</span>
                <span class="n">evaluation_path</span><span class="o">=</span><span class="s2">&quot;cantilever.x_t&quot;</span><span class="p">,</span>
                <span class="n">collect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text/plain&quot;</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">File</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;cantilever_mesh&quot;</span><span class="p">,</span>
                <span class="n">evaluation_path</span><span class="o">=</span><span class="s2">&quot;cantilever.cdb&quot;</span><span class="p">,</span>
                <span class="n">collect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;application/cdb&quot;</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">File</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;canti_plot&quot;</span><span class="p">,</span> <span class="n">evaluation_path</span><span class="o">=</span><span class="s2">&quot;canti_plot.png&quot;</span><span class="p">,</span> <span class="n">collect</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;image/png&quot;</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">project_api</span><span class="o">.</span><span class="n">create_files</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="n">file_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">:</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">}</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;== Define Parameters&quot;</span><span class="p">)</span>
    <span class="c1"># Input parameters</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">FloatParameterDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;canti_length&quot;</span><span class="p">,</span>
            <span class="n">lower_limit</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
            <span class="n">upper_limit</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">350.0</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;um&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">FloatParameterDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;canti_width&quot;</span><span class="p">,</span>
            <span class="n">lower_limit</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
            <span class="n">upper_limit</span><span class="o">=</span><span class="mf">500.0</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;um&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">FloatParameterDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;canti_thickness&quot;</span><span class="p">,</span>
            <span class="n">lower_limit</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
            <span class="n">upper_limit</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;um&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">FloatParameterDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;arm_cutoff_width&quot;</span><span class="p">,</span>
            <span class="n">lower_limit</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">upper_limit</span><span class="o">=</span><span class="mf">250.0</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;um&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">FloatParameterDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;arm_cutoff_length&quot;</span><span class="p">,</span>
            <span class="n">lower_limit</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span>
            <span class="n">upper_limit</span><span class="o">=</span><span class="mf">1000.0</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;um&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">FloatParameterDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;arm_slot_width&quot;</span><span class="p">,</span>
            <span class="n">lower_limit</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">upper_limit</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;um&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">BoolParameterDefinition</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;arm_slot&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">),</span>
        <span class="n">FloatParameterDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;young_modulus&quot;</span><span class="p">,</span>
            <span class="n">lower_limit</span><span class="o">=</span><span class="mf">1e6</span><span class="p">,</span>
            <span class="n">upper_limit</span><span class="o">=</span><span class="mf">1e13</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">3.0e11</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;Pa&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">FloatParameterDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;density&quot;</span><span class="p">,</span>
            <span class="n">lower_limit</span><span class="o">=</span><span class="mf">1e3</span><span class="p">,</span>
            <span class="n">upper_limit</span><span class="o">=</span><span class="mf">6e3</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">3200</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kg/m^3&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">FloatParameterDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;poisson_ratio&quot;</span><span class="p">,</span>
            <span class="n">lower_limit</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
            <span class="n">upper_limit</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mf">0.23</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">IntParameterDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mesh_swept_layers&quot;</span><span class="p">,</span>
            <span class="n">lower_limit</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">upper_limit</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">IntParameterDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;num_modes&quot;</span><span class="p">,</span>
            <span class="n">default</span><span class="o">=</span><span class="n">num_modes</span><span class="p">,</span>
            <span class="n">lower_limit</span><span class="o">=</span><span class="n">num_modes</span><span class="p">,</span>
            <span class="n">upper_limit</span><span class="o">=</span><span class="n">num_modes</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="n">BoolParameterDefinition</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;popup_plots&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">),</span>
        <span class="n">IntParameterDefinition</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;port_geometry&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">50052</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">),</span>
        <span class="n">IntParameterDefinition</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;port_mesh&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">50052</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">),</span>
        <span class="n">IntParameterDefinition</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;port_mapdl&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">50052</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">),</span>
        <span class="n">BoolParameterDefinition</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;clean_venv&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;input&quot;</span><span class="p">),</span>
    <span class="p">]</span>
    <span class="c1"># Output parameters</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_modes</span><span class="p">):</span>
        <span class="n">params</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">FloatParameterDefinition</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;freq_mode_</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;Hz&quot;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;output&quot;</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">project_api</span><span class="o">.</span><span class="n">create_parameter_definitions</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== Define Tasks&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">split_tasks</span><span class="p">:</span>
        <span class="n">task_def_geometry</span> <span class="o">=</span> <span class="n">TaskDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;geometry&quot;</span><span class="p">,</span>
            <span class="n">software_requirements</span><span class="o">=</span><span class="p">[</span><span class="n">Software</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;uv&quot;</span><span class="p">),</span> <span class="n">Software</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ansys GeometryService&quot;</span><span class="p">)],</span>
            <span class="n">resource_requirements</span><span class="o">=</span><span class="n">ResourceRequirements</span><span class="p">(</span>
                <span class="n">num_cores</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">memory</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 2 GB</span>
                <span class="n">disk_space</span><span class="o">=</span><span class="mi">500</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 500 MB</span>
            <span class="p">),</span>
            <span class="n">execution_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">max_execution_time</span><span class="o">=</span><span class="mf">500.0</span><span class="p">,</span>
            <span class="n">num_trials</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">use_execution_script</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">execution_script_id</span><span class="o">=</span><span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;exec_script&quot;</span><span class="p">],</span>
            <span class="n">input_file_ids</span><span class="o">=</span><span class="p">[</span><span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;eval_geometry&quot;</span><span class="p">]],</span>
            <span class="n">output_file_ids</span><span class="o">=</span><span class="p">[</span><span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;cantilever_geometry&quot;</span><span class="p">],</span> <span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;canti_plot&quot;</span><span class="p">]],</span>
            <span class="n">success_criteria</span><span class="o">=</span><span class="n">SuccessCriteria</span><span class="p">(</span>
                <span class="n">return_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">require_all_output_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">task_def_mesh</span> <span class="o">=</span> <span class="n">TaskDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mesh&quot;</span><span class="p">,</span>
            <span class="n">software_requirements</span><span class="o">=</span><span class="p">[</span><span class="n">Software</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;uv&quot;</span><span class="p">),</span> <span class="n">Software</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ansys Prime Server&quot;</span><span class="p">)],</span>
            <span class="n">resource_requirements</span><span class="o">=</span><span class="n">ResourceRequirements</span><span class="p">(</span>
                <span class="n">num_cores</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                <span class="n">memory</span><span class="o">=</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 8 GB</span>
                <span class="n">disk_space</span><span class="o">=</span><span class="mi">500</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 500 MB</span>
            <span class="p">),</span>
            <span class="n">execution_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">max_execution_time</span><span class="o">=</span><span class="mf">500.0</span><span class="p">,</span>
            <span class="n">num_trials</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">use_execution_script</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">execution_script_id</span><span class="o">=</span><span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;exec_script&quot;</span><span class="p">],</span>
            <span class="n">input_file_ids</span><span class="o">=</span><span class="p">[</span><span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;eval_mesh&quot;</span><span class="p">],</span> <span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;cantilever_geometry&quot;</span><span class="p">]],</span>
            <span class="n">output_file_ids</span><span class="o">=</span><span class="p">[</span><span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;cantilever_mesh&quot;</span><span class="p">]],</span>
            <span class="n">success_criteria</span><span class="o">=</span><span class="n">SuccessCriteria</span><span class="p">(</span>
                <span class="n">return_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">require_all_output_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="c1"># hpc_resources=HpcResources(exclusive=True),</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">task_def_mapdl</span> <span class="o">=</span> <span class="n">TaskDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;mapdl&quot;</span><span class="p">,</span>
            <span class="n">software_requirements</span><span class="o">=</span><span class="p">[</span>
                <span class="n">Software</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;uv&quot;</span><span class="p">),</span>
                <span class="n">Software</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ansys Mechanical APDL&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;2025 R2&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">resource_requirements</span><span class="o">=</span><span class="n">ResourceRequirements</span><span class="p">(</span>
                <span class="n">num_cores</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                <span class="n">memory</span><span class="o">=</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 8 GB</span>
                <span class="n">disk_space</span><span class="o">=</span><span class="mi">500</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 500 MB</span>
                <span class="c1"># hpc_resources=HpcResources(exclusive=True),</span>
            <span class="p">),</span>
            <span class="n">execution_level</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="n">max_execution_time</span><span class="o">=</span><span class="mf">500.0</span><span class="p">,</span>
            <span class="n">num_trials</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">use_execution_script</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">execution_script_id</span><span class="o">=</span><span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;exec_script&quot;</span><span class="p">],</span>
            <span class="n">input_file_ids</span><span class="o">=</span><span class="p">[</span><span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;eval_mapdl&quot;</span><span class="p">],</span> <span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;cantilever_mesh&quot;</span><span class="p">]],</span>
            <span class="n">success_criteria</span><span class="o">=</span><span class="n">SuccessCriteria</span><span class="p">(</span>
                <span class="n">return_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">require_all_output_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">task_defs</span> <span class="o">=</span> <span class="n">project_api</span><span class="o">.</span><span class="n">create_task_definitions</span><span class="p">(</span>
            <span class="p">[</span><span class="n">task_def_geometry</span><span class="p">,</span> <span class="n">task_def_mesh</span><span class="p">,</span> <span class="n">task_def_mapdl</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">task_def_combined</span> <span class="o">=</span> <span class="n">TaskDefinition</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;combined&quot;</span><span class="p">,</span>
            <span class="n">software_requirements</span><span class="o">=</span><span class="p">[</span>
                <span class="n">Software</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;uv&quot;</span><span class="p">),</span>
                <span class="n">Software</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ansys GeometryService&quot;</span><span class="p">),</span>
                <span class="n">Software</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ansys Prime Server&quot;</span><span class="p">),</span>
                <span class="n">Software</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Ansys Mechanical APDL&quot;</span><span class="p">,</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;2025 R2&quot;</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">resource_requirements</span><span class="o">=</span><span class="n">ResourceRequirements</span><span class="p">(</span>
                <span class="n">num_cores</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
                <span class="n">memory</span><span class="o">=</span><span class="mi">8</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 8 GB</span>
                <span class="n">disk_space</span><span class="o">=</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 1 GB</span>
                <span class="c1"># hpc_resources=HpcResources(exclusive=True),</span>
            <span class="p">),</span>
            <span class="n">execution_level</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">max_execution_time</span><span class="o">=</span><span class="mf">1200.0</span><span class="p">,</span>
            <span class="n">num_trials</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">use_execution_script</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">execution_script_id</span><span class="o">=</span><span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;exec_script&quot;</span><span class="p">],</span>
            <span class="n">input_file_ids</span><span class="o">=</span><span class="p">[</span><span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;eval_combined&quot;</span><span class="p">]],</span>
            <span class="n">output_file_ids</span><span class="o">=</span><span class="p">[</span>
                <span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;cantilever_mesh&quot;</span><span class="p">],</span>
                <span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;cantilever_geometry&quot;</span><span class="p">],</span>
                <span class="n">file_ids</span><span class="p">[</span><span class="s2">&quot;canti_plot&quot;</span><span class="p">],</span>
            <span class="p">],</span>
            <span class="n">success_criteria</span><span class="o">=</span><span class="n">SuccessCriteria</span><span class="p">(</span>
                <span class="n">return_code</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">require_all_output_parameters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">require_all_output_files</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">),</span>
        <span class="p">)</span>
        <span class="n">task_defs</span> <span class="o">=</span> <span class="n">project_api</span><span class="o">.</span><span class="n">create_task_definitions</span><span class="p">([</span><span class="n">task_def_combined</span><span class="p">])</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;== Define Fitness&quot;</span><span class="p">)</span>
    <span class="n">fd</span> <span class="o">=</span> <span class="n">FitnessDefinition</span><span class="p">(</span><span class="n">error_fitness</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="n">fd</span><span class="o">.</span><span class="n">add_fitness_term</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;frequency&quot;</span><span class="p">,</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;target_constraint&quot;</span><span class="p">,</span>
        <span class="n">weighting_factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="n">expression</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;map_target_constraint(values[&#39;freq_mode_1&#39;], </span><span class="se">\</span>
<span class="s2">            </span><span class="si">{</span><span class="n">target_frequency</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="mf">0.01</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">target_frequency</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="mf">0.5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">target_frequency</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;== Define Job&quot;</span><span class="p">)</span>
    <span class="n">job_def</span> <span class="o">=</span> <span class="n">JobDefinition</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;JobDefinition.1&quot;</span><span class="p">,</span>
        <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">parameter_definition_ids</span><span class="o">=</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">],</span>
        <span class="n">task_definition_ids</span><span class="o">=</span><span class="p">[</span><span class="n">td</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">task_defs</span><span class="p">],</span>
        <span class="n">fitness_definition</span><span class="o">=</span><span class="n">fd</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">job_def</span> <span class="o">=</span> <span class="n">project_api</span><span class="o">.</span><span class="n">create_job_definitions</span><span class="p">([</span><span class="n">job_def</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Refresh parameters</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">project_api</span><span class="o">.</span><span class="n">get_parameter_definitions</span><span class="p">(</span><span class="n">job_def</span><span class="o">.</span><span class="n">parameter_definition_ids</span><span class="p">)</span>
    <span class="n">params_by_name</span> <span class="o">=</span> <span class="p">{</span><span class="n">p</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]:</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">}</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;== Create </span><span class="si">{</span><span class="n">num_jobs</span><span class="si">}</span><span class="s2"> Jobs&quot;</span><span class="p">)</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_jobs</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="n">generate_parameter_values_for_job</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">params_by_name</span><span class="p">)</span>
        <span class="n">jobs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">Job</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Job.</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">values</span><span class="p">,</span> <span class="n">eval_status</span><span class="o">=</span><span class="s2">&quot;pending&quot;</span><span class="p">,</span> <span class="n">job_definition_id</span><span class="o">=</span><span class="n">job_def</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="n">jobs</span> <span class="o">=</span> <span class="n">project_api</span><span class="o">.</span><span class="n">create_jobs</span><span class="p">(</span><span class="n">jobs</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created project &#39;</span><span class="si">{</span><span class="n">proj</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;, ID=&#39;</span><span class="si">{</span><span class="n">proj</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">proj</span>


<span class="k">def</span><span class="w"> </span><span class="nf">entrypoint</span><span class="p">(</span>
    <span class="n">url</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;https://localhost:8443/hps&quot;</span><span class="p">,</span> <span class="s2">&quot;-U&quot;</span><span class="p">,</span> <span class="s2">&quot;--url&quot;</span><span class="p">),</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;repuser&quot;</span><span class="p">,</span> <span class="s2">&quot;-u&quot;</span><span class="p">,</span> <span class="s2">&quot;--username&quot;</span><span class="p">),</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="s2">&quot;repuser&quot;</span><span class="p">,</span> <span class="s2">&quot;-p&quot;</span><span class="p">,</span> <span class="s2">&quot;--password&quot;</span><span class="p">),</span>
    <span class="n">num_jobs</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;-n&quot;</span><span class="p">,</span> <span class="s2">&quot;--num-jobs&quot;</span><span class="p">),</span>
    <span class="n">num_modes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&quot;-m&quot;</span><span class="p">,</span> <span class="s2">&quot;--num-modes&quot;</span><span class="p">),</span>
    <span class="n">freq_tgt</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="mf">100.0</span><span class="p">,</span> <span class="s2">&quot;-f&quot;</span><span class="p">,</span> <span class="s2">&quot;--target-frequency&quot;</span><span class="p">),</span>
    <span class="n">split_tasks</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">typer</span><span class="o">.</span><span class="n">Option</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;-s&quot;</span><span class="p">,</span> <span class="s2">&quot;--split-tasks&quot;</span><span class="p">),</span>
<span class="p">):</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Arguments:&quot;</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="se">\n</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="se">\n</span><span class="s2">jobs: </span><span class="si">{</span><span class="n">num_jobs</span><span class="si">}</span><span class="se">\n</span><span class="s2">modes: </span><span class="si">{</span><span class="n">num_modes</span><span class="si">}</span><span class="se">\n</span><span class="s2">freq: </span><span class="si">{</span><span class="n">freq_tgt</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>

    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;[</span><span class="si">%(asctime)s</span><span class="s2"> | </span><span class="si">%(levelname)s</span><span class="s2">] </span><span class="si">%(message)s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>

    <span class="n">client</span> <span class="o">=</span> <span class="n">Client</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">main</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">num_jobs</span><span class="p">,</span> <span class="n">num_modes</span><span class="p">,</span> <span class="n">freq_tgt</span><span class="p">,</span> <span class="n">split_tasks</span><span class="p">)</span>
    <span class="k">except</span> <span class="n">HPSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">sample_parameter</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">minval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">maxval</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">minval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">minval</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">lower_limit</span>
    <span class="k">if</span> <span class="n">maxval</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">maxval</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">upper_limit</span>
    <span class="k">return</span> <span class="n">minval</span> <span class="o">+</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="n">maxval</span> <span class="o">-</span> <span class="n">minval</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">generate_parameter_values_for_job</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">params_by_name</span><span class="p">):</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;canti_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_parameter</span><span class="p">(</span><span class="n">params_by_name</span><span class="p">[</span><span class="s2">&quot;canti_length&quot;</span><span class="p">])</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;canti_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_parameter</span><span class="p">(</span><span class="n">params_by_name</span><span class="p">[</span><span class="s2">&quot;canti_width&quot;</span><span class="p">])</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;canti_thickness&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_parameter</span><span class="p">(</span><span class="n">params_by_name</span><span class="p">[</span><span class="s2">&quot;canti_thickness&quot;</span><span class="p">])</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;arm_cutoff_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_parameter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;canti_width&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">2.5</span><span class="p">)</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;arm_cutoff_length&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_parameter</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;canti_length&quot;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;arm_slot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">values</span><span class="p">[</span><span class="s2">&quot;arm_slot_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sample_parameter</span><span class="p">(</span>
            <span class="kc">None</span><span class="p">,</span>
            <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;canti_width&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;arm_cutoff_width&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.2</span><span class="p">,</span>
            <span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;canti_width&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;arm_cutoff_width&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;port_geometry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">49153</span><span class="p">,</span> <span class="mi">59999</span><span class="p">)</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;port_mesh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">49153</span><span class="p">,</span> <span class="mi">59999</span><span class="p">)</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;port_mapdl&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">49153</span><span class="p">,</span> <span class="mi">59999</span><span class="p">)</span>
    <span class="n">values</span><span class="p">[</span><span class="s2">&quot;clean_venv&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">values</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># Verify that ansys-hps-client version is &gt; 0.10.1 to ensure support for unmapped parameters</span>
    <span class="k">if</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">ansys</span><span class="o">.</span><span class="n">hps</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">version</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="s2">&quot;0.10.1&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;ERR: ansys-hps-client version </span><span class="si">{</span><span class="n">ansys</span><span class="o">.</span><span class="n">hps</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                does not satisfy &#39;&gt;0.10.1&#39;&quot;</span>
        <span class="p">)</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">typer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">entrypoint</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Here is the <code class="docutils literal notranslate"><span class="pre">exec_script.py</span></code> script:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">exec_script.py</span><a class="headerlink" href="#id2" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;Simplistic execution script for Python with uv.</span>

<span class="sd">Command formed: uv run &lt;script_file&gt; &lt;input_file&gt;</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">ansys.rep.common.logging</span><span class="w"> </span><span class="kn">import</span> <span class="n">log</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ansys.rep.evaluator.task_manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">ApplicationExecution</span>


<span class="k">class</span><span class="w"> </span><span class="nc">PythonExecution</span><span class="p">(</span><span class="n">ApplicationExecution</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">execute</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Start uv execution script&quot;</span><span class="p">)</span>

        <span class="c1"># Identify files</span>
        <span class="n">script_file</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
            <span class="p">(</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">input_files</span> <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;eval_&quot;</span><span class="p">)),</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">assert</span> <span class="n">script_file</span><span class="p">,</span> <span class="s2">&quot;Python script file missing&quot;</span>
        <span class="n">input_filename</span> <span class="o">=</span> <span class="s2">&quot;input_parameters.json&quot;</span>
        <span class="n">output_filename</span> <span class="o">=</span> <span class="s2">&quot;output_parameters.json&quot;</span>

        <span class="c1"># Use assigned resources</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">parameter_values</span><span class="p">[</span><span class="s2">&quot;num_cores&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">resource_requirements</span><span class="p">[</span><span class="s2">&quot;num_cores&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">parameter_values</span><span class="p">[</span><span class="s2">&quot;memory_b&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">resource_requirements</span><span class="p">[</span><span class="s2">&quot;memory&quot;</span><span class="p">]</span>

        <span class="c1"># Pass parameters</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">in_file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">parameter_values</span><span class="p">,</span> <span class="n">in_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Identify applications</span>
        <span class="n">app_uv</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">software</span> <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;uv&quot;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="c1"># app_xvfb = next((a for a in self.context.software if a[&quot;name&quot;] == &quot;Xvfb-run&quot;), None)</span>
        <span class="k">assert</span> <span class="n">app_uv</span><span class="p">,</span> <span class="s2">&quot;Cannot find app uv&quot;</span>

        <span class="c1"># Add &quot; around exe if needed for Windows</span>
        <span class="n">exes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;uv&quot;</span><span class="p">:</span> <span class="n">app_uv</span><span class="p">[</span><span class="s2">&quot;executable&quot;</span><span class="p">]}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">exes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot; &quot;</span> <span class="ow">in</span> <span class="n">v</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span>
                <span class="n">exes</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s1">&quot;&#39;</span>  <span class="c1"># noqa</span>

        <span class="c1"># Invoke xvfb if available</span>
        <span class="c1"># if app_xvfb != None:</span>
        <span class="c1">#    exes[&#39;uv&#39;] = &quot;pkill Xvfb; &quot; + app_xvfb[&#39;executable&#39;] + &quot; &quot; + exes[&#39;uv&#39;]</span>

        <span class="c1"># Use properties from resource requirements</span>
        <span class="c1"># None currently</span>

        <span class="c1"># Pass env vars correctly</span>
        <span class="n">env</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">environment</span><span class="p">)</span>

        <span class="c1">## Run evaluation script</span>
        <span class="n">cmd</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">exes</span><span class="p">[</span><span class="s1">&#39;uv&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> run </span><span class="si">{</span><span class="n">script_file</span><span class="p">[</span><span class="s1">&#39;path&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">input_filename</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_and_capture_output</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">env</span><span class="o">=</span><span class="n">env</span><span class="p">)</span>

        <span class="c1"># Extract parameters if needed</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading output parameters from </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
                <span class="n">output_parameters</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">out_file</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">parameter_values</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">output_parameters</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loaded output parameters: </span><span class="si">{</span><span class="n">output_parameters</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;No output parameters found.&quot;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to read output parameters from file: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Clean up venv cache</span>
        <span class="k">if</span> <span class="s2">&quot;exe&quot;</span> <span class="ow">in</span> <span class="n">output_parameters</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">parameter_values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;clean_venv&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">venv_cache</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_parameters</span><span class="p">[</span><span class="s2">&quot;exe&quot;</span><span class="p">],</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">))</span>
                <span class="n">venv_cache_parent</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">venv_cache</span><span class="p">,</span> <span class="s2">&quot;..&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">venv_cache</span><span class="p">):</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current venv cache: </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">venv_cache_parent</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cleaning venv cache at </span><span class="si">{</span><span class="n">venv_cache</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
                    <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">venv_cache</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Venv cache path </span><span class="si">{</span><span class="n">venv_cache</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Couldn&#39;t clean venv cache at </span><span class="si">{</span><span class="n">venv_cache</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">ex</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;End Python execution script&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Here is the <code class="docutils literal notranslate"><span class="pre">eval_combined.py</span></code> script for combined evaluation:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">eval_combined.py</span><a class="headerlink" href="#id3" title="Link to this code">#</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># /// script</span>
<span class="c1"># requires-python = &quot;==3.10&quot;</span>
<span class="c1"># dependencies = [</span>
<span class="c1">#     &quot;ansys-geometry-core[all]&quot;,</span>
<span class="c1">#     &quot;ansys-meshing-prime[all]==0.7&quot;,</span>
<span class="c1">#     &quot;ansys.mapdl.core&quot;,</span>
<span class="c1">#     &quot;matplotlib&quot;</span>
<span class="c1"># ]</span>
<span class="c1"># ///</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.patches</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">patches</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="kn">import</span> <span class="n">FuncFormatter</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">ansys.meshing.prime</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">prime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ansys.geometry.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">launch_modeler</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ansys.geometry.core.designer</span><span class="w"> </span><span class="kn">import</span> <span class="n">DesignFileFormat</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ansys.geometry.core.math</span><span class="w"> </span><span class="kn">import</span> <span class="n">Point2D</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ansys.geometry.core.sketch</span><span class="w"> </span><span class="kn">import</span> <span class="n">Sketch</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ansys.mapdl.core</span><span class="w"> </span><span class="kn">import</span> <span class="n">launch_mapdl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">ansys.meshing.prime.graphics</span><span class="w"> </span><span class="kn">import</span> <span class="n">PrimePlotter</span>


<span class="k">def</span><span class="w"> </span><span class="nf">geometry</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="c1"># Read parameters, convert to meters</span>
    <span class="n">um2m</span> <span class="o">=</span> <span class="mf">1e-6</span>
    <span class="n">width</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;canti_width&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">um2m</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;canti_length&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">um2m</span>
    <span class="n">thickness</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;canti_thickness&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">um2m</span>
    <span class="n">arm_cutoff_width</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;arm_cutoff_width&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">um2m</span>
    <span class="n">arm_cutoff_length</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;arm_cutoff_length&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">um2m</span>
    <span class="n">arm_slot</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;arm_slot&quot;</span><span class="p">]</span>
    <span class="n">arm_slot_width</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;arm_slot_width&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">um2m</span>
    <span class="n">popup_plots</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;popup_plots&quot;</span><span class="p">]</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;port_geometry&quot;</span><span class="p">]</span>
    <span class="n">arm_width</span> <span class="o">=</span> <span class="n">width</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">arm_cutoff_width</span>

    <span class="c1"># Check input</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">arm_cutoff_length</span> <span class="o">&gt;</span> <span class="n">length</span>
        <span class="ow">or</span> <span class="n">arm_width</span> <span class="o">&lt;=</span> <span class="mf">0.0</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">arm_slot</span> <span class="ow">and</span> <span class="n">arm_slot_width</span> <span class="o">&gt;</span> <span class="n">arm_width</span><span class="p">)</span>
        <span class="ow">or</span> <span class="p">(</span><span class="n">arm_slot</span> <span class="ow">and</span> <span class="n">arm_slot_width</span> <span class="o">&gt;</span> <span class="n">width</span><span class="p">)</span>
    <span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SanityError: Cantilever dimensions are not sane.&quot;</span><span class="p">)</span>

    <span class="c1"># Draw Cantilever in 2D Sketch</span>
    <span class="n">canti_sketch</span> <span class="o">=</span> <span class="n">Sketch</span><span class="p">()</span>
    <span class="n">canti_sketch</span><span class="o">.</span><span class="n">segment</span><span class="p">(</span>
        <span class="n">start</span><span class="o">=</span><span class="n">Point2D</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">arm_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]),</span> <span class="n">end</span><span class="o">=</span><span class="n">Point2D</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">arm_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">])</span>
    <span class="p">)</span>
    <span class="n">canti_sketch</span><span class="o">.</span><span class="n">segment_to_point</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">Point2D</span><span class="p">([</span><span class="n">arm_cutoff_length</span><span class="p">,</span> <span class="n">arm_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]))</span>
    <span class="n">canti_sketch</span><span class="o">.</span><span class="n">segment_to_point</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">Point2D</span><span class="p">([</span><span class="n">arm_cutoff_length</span><span class="p">,</span> <span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]))</span>
    <span class="n">canti_sketch</span><span class="o">.</span><span class="n">segment_to_point</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">Point2D</span><span class="p">([</span><span class="n">length</span><span class="p">,</span> <span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]))</span>
    <span class="n">canti_sketch</span><span class="o">.</span><span class="n">segment_to_point</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">Point2D</span><span class="p">([</span><span class="n">length</span><span class="p">,</span> <span class="o">-</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]))</span>
    <span class="n">canti_sketch</span><span class="o">.</span><span class="n">segment_to_point</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">Point2D</span><span class="p">([</span><span class="n">arm_cutoff_length</span><span class="p">,</span> <span class="o">-</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]))</span>
    <span class="n">canti_sketch</span><span class="o">.</span><span class="n">segment_to_point</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">Point2D</span><span class="p">([</span><span class="n">arm_cutoff_length</span><span class="p">,</span> <span class="o">-</span><span class="n">arm_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]))</span>
    <span class="n">canti_sketch</span><span class="o">.</span><span class="n">segment_to_point</span><span class="p">(</span><span class="n">end</span><span class="o">=</span><span class="n">Point2D</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">arm_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">]))</span>

    <span class="c1"># Add arm slot if it exists</span>
    <span class="k">if</span> <span class="n">arm_slot</span><span class="p">:</span>
        <span class="n">canti_sketch</span><span class="o">.</span><span class="n">box</span><span class="p">(</span>
            <span class="n">Point2D</span><span class="p">([</span><span class="n">arm_cutoff_length</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mf">2.5e-6</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">]),</span>
            <span class="n">arm_cutoff_length</span> <span class="o">-</span> <span class="mf">5e-6</span><span class="p">,</span>
            <span class="n">arm_slot_width</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Create a modeler, extrude sketches, union bodies</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">modeler</span> <span class="o">=</span> <span class="n">launch_modeler</span><span class="p">(</span><span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">modeler</span><span class="p">)</span>

        <span class="n">design</span> <span class="o">=</span> <span class="n">modeler</span><span class="o">.</span><span class="n">create_design</span><span class="p">(</span><span class="s2">&quot;cantilever&quot;</span><span class="p">)</span>
        <span class="n">design</span><span class="o">.</span><span class="n">extrude_sketch</span><span class="p">(</span><span class="s2">&quot;cantilever&quot;</span><span class="p">,</span> <span class="n">canti_sketch</span><span class="p">,</span> <span class="n">thickness</span><span class="p">)</span>

        <span class="c1"># Plot if requested</span>
        <span class="k">if</span> <span class="n">popup_plots</span><span class="p">:</span>
            <span class="n">design</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

        <span class="c1"># Draw matplotlib figure</span>
        <span class="n">points</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">arm_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">arm_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
            <span class="p">[</span><span class="n">arm_cutoff_length</span><span class="p">,</span> <span class="n">arm_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
            <span class="p">[</span><span class="n">arm_cutoff_length</span><span class="p">,</span> <span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
            <span class="p">[</span><span class="n">length</span><span class="p">,</span> <span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
            <span class="p">[</span><span class="n">length</span><span class="p">,</span> <span class="o">-</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
            <span class="p">[</span><span class="n">arm_cutoff_length</span><span class="p">,</span> <span class="o">-</span><span class="n">width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
            <span class="p">[</span><span class="n">arm_cutoff_length</span><span class="p">,</span> <span class="o">-</span><span class="n">arm_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="n">arm_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
        <span class="p">]</span>
        <span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">points</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">arm_slot</span><span class="p">:</span>
            <span class="n">slot_points</span> <span class="o">=</span> <span class="p">[</span>
                <span class="p">[</span><span class="mf">2.5e-6</span><span class="p">,</span> <span class="n">arm_slot_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
                <span class="p">[</span><span class="n">arm_cutoff_length</span> <span class="o">-</span> <span class="mf">2.5e-6</span><span class="p">,</span> <span class="n">arm_slot_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
                <span class="p">[</span><span class="n">arm_cutoff_length</span> <span class="o">-</span> <span class="mf">2.5e-6</span><span class="p">,</span> <span class="o">-</span><span class="n">arm_slot_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">2.5e-6</span><span class="p">,</span> <span class="o">-</span><span class="n">arm_slot_width</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">],</span>
            <span class="p">]</span>
            <span class="n">slot_xs</span><span class="p">,</span> <span class="n">slot_ys</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">slot_points</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">slot_xs</span><span class="p">,</span> <span class="n">slot_ys</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">wall</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
            <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">length</span><span class="p">,</span> <span class="o">-</span><span class="nb">max</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="p">)),</span>
            <span class="n">width</span><span class="o">=</span><span class="n">length</span><span class="p">,</span>
            <span class="n">height</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">length</span><span class="p">),</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;#B16100&quot;</span><span class="p">,</span>
            <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;///&quot;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">wall</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
        <span class="n">ax_length</span> <span class="o">=</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">length</span> <span class="o">+</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span> <span class="o">*</span> <span class="n">length</span><span class="p">,</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="nb">max</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">width</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">ax_length</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">ax_length</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Cantilever&quot;</span><span class="p">)</span>
        <span class="n">formatter</span> <span class="o">=</span> <span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1e6</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">formatter</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x [um]&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y [um]&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;canti_plot.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

        <span class="c1"># export has different extensions on different OSs (.x_t, .xmt_txt)</span>
        <span class="c1"># design.export_to_parasolid_text(os.getcwd())</span>
        <span class="n">design</span><span class="o">.</span><span class="n">download</span><span class="p">(</span>
            <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">design</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot;.x_t&quot;</span><span class="p">),</span> <span class="n">DesignFileFormat</span><span class="o">.</span><span class="n">PARASOLID_TEXT</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception in geometry: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">modeler</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="k">def</span><span class="w"> </span><span class="nf">mesh</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">ansys_prime_root</span><span class="p">):</span>
    <span class="c1"># Read relevant dimensions from parameters</span>
    <span class="n">um2mm</span> <span class="o">=</span> <span class="mf">1e-3</span>
    <span class="n">swept_layers</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;mesh_swept_layers&quot;</span><span class="p">]</span>
    <span class="n">thickness</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;canti_thickness&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">um2mm</span>
    <span class="n">length</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;canti_length&quot;</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;arm_cutoff_length&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">um2mm</span>
    <span class="n">width</span> <span class="o">=</span> <span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;canti_width&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;arm_cutoff_width&quot;</span><span class="p">])</span> <span class="o">*</span> <span class="n">um2mm</span>
    <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;arm_slot&quot;</span><span class="p">]:</span>
        <span class="n">width</span> <span class="o">-=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;arm_slot_width&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">um2mm</span>
        <span class="n">width</span> <span class="o">/=</span> <span class="mf">2.0</span>
    <span class="n">min_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.05</span>
    <span class="n">max_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.3</span>
    <span class="n">popup_plots</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;popup_plots&quot;</span><span class="p">]</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;port_mesh&quot;</span><span class="p">]</span>

    <span class="n">cad_file</span> <span class="o">=</span> <span class="s2">&quot;cantilever.x_t&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cad_file</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Input file </span><span class="si">{</span><span class="n">cad_file</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">with</span> <span class="n">prime</span><span class="o">.</span><span class="n">launch_prime</span><span class="p">(</span><span class="n">prime_root</span><span class="o">=</span><span class="n">ansys_prime_root</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">)</span> <span class="k">as</span> <span class="n">prime_client</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">prime_client</span><span class="o">.</span><span class="n">model</span>
        <span class="n">mesh_util</span> <span class="o">=</span> <span class="n">prime</span><span class="o">.</span><span class="n">lucid</span><span class="o">.</span><span class="n">Mesh</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">)</span>

        <span class="c1"># Import geometry</span>
        <span class="n">mesh_util</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">file_name</span><span class="o">=</span><span class="n">cad_file</span><span class="p">,</span> <span class="n">cad_reader_route</span><span class="o">=</span><span class="n">prime</span><span class="o">.</span><span class="n">CadReaderRoute</span><span class="o">.</span><span class="n">PROGRAMCONTROLLED</span><span class="p">)</span>

        <span class="c1"># Set mesh size</span>
        <span class="n">sizing_params</span> <span class="o">=</span> <span class="n">prime</span><span class="o">.</span><span class="n">GlobalSizingParams</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="n">min_size</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">max_size</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">set_global_sizing_params</span><span class="p">(</span><span class="n">params</span><span class="o">=</span><span class="n">sizing_params</span><span class="p">)</span>

        <span class="n">part</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sweeper</span> <span class="o">=</span> <span class="n">prime</span><span class="o">.</span><span class="n">VolumeSweeper</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>

        <span class="n">stacker_params</span> <span class="o">=</span> <span class="n">prime</span><span class="o">.</span><span class="n">MeshStackerParams</span><span class="p">(</span>
            <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
            <span class="n">direction</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">max_offset_size</span><span class="o">=</span><span class="n">thickness</span> <span class="o">/</span> <span class="n">swept_layers</span><span class="p">,</span>
            <span class="n">delete_base</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Create the base face</span>
        <span class="n">createbase_results</span> <span class="o">=</span> <span class="n">sweeper</span><span class="o">.</span><span class="n">create_base_face</span><span class="p">(</span>
            <span class="n">part_id</span><span class="o">=</span><span class="n">part</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">topo_volume_ids</span><span class="o">=</span><span class="n">part</span><span class="o">.</span><span class="n">get_topo_volumes</span><span class="p">(),</span>
            <span class="n">params</span><span class="o">=</span><span class="n">stacker_params</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">base_faces</span> <span class="o">=</span> <span class="n">createbase_results</span><span class="o">.</span><span class="n">base_face_ids</span>

        <span class="n">part</span><span class="o">.</span><span class="n">add_labels_on_topo_entities</span><span class="p">([</span><span class="s2">&quot;base_faces&quot;</span><span class="p">],</span> <span class="n">base_faces</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">popup_plots</span><span class="p">:</span>
            <span class="n">scope</span> <span class="o">=</span> <span class="n">prime</span><span class="o">.</span><span class="n">ScopeDefinition</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span> <span class="n">label_expression</span><span class="o">=</span><span class="s2">&quot;base_faces&quot;</span><span class="p">)</span>
            <span class="n">display</span> <span class="o">=</span> <span class="n">PrimePlotter</span><span class="p">()</span>
            <span class="n">display</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">)</span>
            <span class="n">display</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">base_scope</span> <span class="o">=</span> <span class="n">prime</span><span class="o">.</span><span class="n">lucid</span><span class="o">.</span><span class="n">SurfaceScope</span><span class="p">(</span>
            <span class="n">entity_expression</span><span class="o">=</span><span class="s2">&quot;base_faces&quot;</span><span class="p">,</span>
            <span class="n">part_expression</span><span class="o">=</span><span class="n">part</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">scope_evaluation_type</span><span class="o">=</span><span class="n">prime</span><span class="o">.</span><span class="n">ScopeEvaluationType</span><span class="o">.</span><span class="n">LABELS</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Create mesh on base face</span>
        <span class="n">mesh_util</span><span class="o">.</span><span class="n">surface_mesh</span><span class="p">(</span>
            <span class="n">min_size</span><span class="o">=</span><span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span><span class="o">=</span><span class="n">max_size</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">base_scope</span><span class="p">,</span> <span class="n">generate_quads</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">popup_plots</span><span class="p">:</span>
            <span class="n">display</span> <span class="o">=</span> <span class="n">PrimePlotter</span><span class="p">()</span>
            <span class="n">display</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="n">scope</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">display</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># Sweep base mesh through body</span>
        <span class="n">sweeper</span><span class="o">.</span><span class="n">stack_base_face</span><span class="p">(</span>
            <span class="n">part_id</span><span class="o">=</span><span class="n">part</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">base_face_ids</span><span class="o">=</span><span class="n">base_faces</span><span class="p">,</span>
            <span class="n">topo_volume_ids</span><span class="o">=</span><span class="n">part</span><span class="o">.</span><span class="n">get_topo_volumes</span><span class="p">(),</span>
            <span class="n">params</span><span class="o">=</span><span class="n">stacker_params</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">popup_plots</span><span class="p">:</span>
            <span class="n">display</span> <span class="o">=</span> <span class="n">PrimePlotter</span><span class="p">()</span>
            <span class="n">display</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">update</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">display</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="n">mesh_file</span> <span class="o">=</span> <span class="s2">&quot;cantilever.cdb&quot;</span>
        <span class="n">mesh_util</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="n">mesh_file</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">extract_frequencies</span><span class="p">(</span><span class="n">output_string</span><span class="p">,</span> <span class="n">num_freqs</span><span class="p">):</span>
    <span class="n">mode_freqs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">output_string</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">split</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">split</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">mode_freqs</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;freq_mode_</span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="n">num_freqs</span><span class="p">:</span>
                <span class="k">break</span>
    <span class="k">return</span> <span class="n">mode_freqs</span>


<span class="k">def</span><span class="w"> </span><span class="nf">mapdl</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="c1"># Read Parameters</span>
    <span class="n">num_modes</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;num_modes&quot;</span><span class="p">]</span>
    <span class="n">young_modulus</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;young_modulus&quot;</span><span class="p">]</span>
    <span class="n">density</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span>
    <span class="n">poisson_ratio</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;poisson_ratio&quot;</span><span class="p">]</span>
    <span class="n">popup_plots</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;popup_plots&quot;</span><span class="p">]</span>
    <span class="n">port</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;port_mapdl&quot;</span><span class="p">]</span>
    <span class="n">num_cores</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;num_cores&quot;</span><span class="p">]</span>
    <span class="n">memory_mb</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;memory_b&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">1024.0</span><span class="o">**</span><span class="mi">2</span>

    <span class="n">input_filename</span> <span class="o">=</span> <span class="s2">&quot;cantilever.cdb&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">input_filename</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ERROR: Input file </span><span class="si">{</span><span class="n">input_filename</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Launch MAPDL as a service</span>
        <span class="n">mapdl</span> <span class="o">=</span> <span class="n">launch_mapdl</span><span class="p">(</span>
            <span class="n">start_instance</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;grpc&quot;</span><span class="p">,</span>
            <span class="n">loglevel</span><span class="o">=</span><span class="s2">&quot;DEBUG&quot;</span><span class="p">,</span>
            <span class="n">run_location</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">port</span><span class="o">=</span><span class="n">port</span><span class="p">,</span>
            <span class="n">nproc</span><span class="o">=</span><span class="n">num_cores</span><span class="p">,</span>
            <span class="n">ram</span><span class="o">=</span><span class="n">memory_mb</span><span class="p">,</span>
            <span class="n">running_on_hpc</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">mapdl</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">mute</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

        <span class="c1"># Load input file</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">input</span><span class="p">(</span><span class="s2">&quot;cantilever.cdb&quot;</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">prep7</span><span class="p">()</span>

        <span class="c1"># Define material properties</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">mp</span><span class="p">(</span><span class="s2">&quot;EX&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">young_modulus</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">mp</span><span class="p">(</span><span class="s2">&quot;EY&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">young_modulus</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">mp</span><span class="p">(</span><span class="s2">&quot;EZ&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">young_modulus</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">mp</span><span class="p">(</span><span class="s2">&quot;PRXY&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">poisson_ratio</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">mp</span><span class="p">(</span><span class="s2">&quot;PRYZ&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">poisson_ratio</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">mp</span><span class="p">(</span><span class="s2">&quot;PRXZ&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">poisson_ratio</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">mp</span><span class="p">(</span><span class="s2">&quot;DENS&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">density</span><span class="p">)</span>

        <span class="c1"># Apply prestress</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">allsel</span><span class="p">()</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">inistate</span><span class="p">(</span><span class="s2">&quot;DEFINE&quot;</span><span class="p">,</span> <span class="n">val5</span><span class="o">=</span><span class="mf">100.0e6</span><span class="p">,</span> <span class="n">val6</span><span class="o">=</span><span class="mf">100.0e6</span><span class="p">,</span> <span class="n">val7</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>

        <span class="c1"># Apply cantilever boundary conditions</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">allsel</span><span class="p">()</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">emodif</span><span class="p">(</span><span class="s2">&quot;ALL&quot;</span><span class="p">,</span> <span class="s2">&quot;MAT&quot;</span><span class="p">,</span> <span class="n">i1</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">nsel</span><span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span> <span class="s2">&quot;LOC&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Fixing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">mapdl</span><span class="o">.</span><span class="n">get_array</span><span class="p">(</span><span class="s1">&#39;NODE&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">item1</span><span class="o">=</span><span class="s1">&#39;NLIST&#39;</span><span class="p">))</span><span class="si">}</span><span class="s2"> nodes&quot;</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">d</span><span class="p">(</span><span class="s2">&quot;ALL&quot;</span><span class="p">,</span> <span class="s2">&quot;ALL&quot;</span><span class="p">)</span>

        <span class="c1"># Set keyopt properties</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">allsel</span><span class="p">()</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">etlist</span><span class="p">()</span>
        <span class="n">element_type_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">mapdl</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ETYPE&quot;</span><span class="p">,</span> <span class="s2">&quot;ELEM&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="s2">&quot;ATTR&quot;</span><span class="p">,</span> <span class="s2">&quot;TYPE&quot;</span><span class="p">))</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">keyopt</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">element_type_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="s2">&quot;2&quot;</span><span class="p">,</span> <span class="s2">&quot;3&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Solve modal</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">slashsolu</span><span class="p">()</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">antype</span><span class="p">(</span><span class="s2">&quot;MODAL&quot;</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">modopt</span><span class="p">(</span><span class="s2">&quot;LANB&quot;</span><span class="p">,</span> <span class="n">num_modes</span><span class="p">)</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">mxpand</span><span class="p">(</span><span class="n">num_modes</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">mapdl</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Extract calculated Eigenfrequencies</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">post1</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">mapdl</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s2">&quot;LIST&quot;</span><span class="p">,</span> <span class="n">mute</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">mode_freqs</span> <span class="o">=</span> <span class="n">extract_frequencies</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">popup_plots</span><span class="p">:</span>
            <span class="n">mode_num</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">mapdl</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode_num</span><span class="p">)</span>
            <span class="n">mapdl</span><span class="o">.</span><span class="n">plnsol</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="s2">&quot;sum&quot;</span><span class="p">)</span>

        <span class="n">mode_freqs</span><span class="p">[</span><span class="s2">&quot;exe&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">executable</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;output_parameters.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">out_file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">mode_freqs</span><span class="p">,</span> <span class="n">out_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exception in mapdl: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">mapdl</span><span class="o">.</span><span class="n">exit</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;python exe: </span><span class="si">{</span><span class="n">sys</span><span class="o">.</span><span class="n">executable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Fetch parameters</span>
    <span class="n">input_file_name</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">input_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">input_file_name</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">input_file_path</span><span class="p">)</span> <span class="k">as</span> <span class="n">input_file</span><span class="p">:</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">input_file</span><span class="p">)</span>

    <span class="n">ansys_prime_root</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;ANSYS_PRIME_ROOT&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Run program step by step</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===Designing Geometry&quot;</span><span class="p">)</span>
    <span class="n">geometry</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===Drawing Mesh&quot;</span><span class="p">)</span>
    <span class="n">mesh</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">ansys_prime_root</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;===Computing Eigenfrequencies&quot;</span><span class="p">)</span>
    <span class="n">mapdl</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Download the ZIP file for the PyAnsys cantilever example and use
a tool such as 7-Zip to extract the files.</p>
<p id="bottom-of-this-page"><span class="sd-d-grid"><a class="sd-sphinx-override sd-btn sd-text-wrap sd-btn-black reference external" href="../_downloads/python_pyansys_cantilever.zip"><span>Download ZIP file</span></a></span></p>
</section>


                </article>
              
              
              
              
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">PyAnsys workflow: Cantilever</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequisites">Prerequisites</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uv">uv</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ansys-geometry-service">Ansys Geometry Service</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ansys-prime-server">Ansys Prime Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ansys-mechanical-apdl">Ansys Mechanical APDL</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#hps-python-client">HPS Python Client</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#run-the-example">Run the example</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#options">Options</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters">Parameters</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#logic-of-the-example">Logic of the example</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#code">Code</a></li>
</ul>

  </nav></div>

  <div class="sidebar-secondary-item">
<!-- If there is no fix edit button function, use the PyData edit-this-button-->
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>


  <!-- Include desired assets -->
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.7/require.min.js"></script>

<script>
// Passing the search options to the search.js file
const SEARCH_OPTIONS = JSON.parse('{"keys": ["title", "text", "objectID"], "limit": 10, "threshold": 0.2}');
const SEARCH_FILE = "../_static/search.json";
const ADVANCE_SEARCH_PATH = "../search.html";
const EXTRA_SOURCES = JSON.parse('""');
</script>


<script src="../_static/js/search.js"></script>

  
  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright (c) 2025 ANSYS, Inc. All rights reserved.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.1.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the
  <a href="https://sphinxdocs.ansys.com/version/stable/index.html"
    >Ansys Sphinx Theme</a
  >
  1.5.3. <br />Last updated on
  <span id="ast_build_date"></span>
</p>
<script>
  var options = { day: "numeric", month: "long", year: "numeric" };
  var ast_lastModifiedDate = new Date(document.lastModified);
  var ast_build_date = ast_lastModifiedDate.toLocaleDateString("en-US", options);
  document.getElementById("ast_build_date").innerHTML = ast_build_date;
</script></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>